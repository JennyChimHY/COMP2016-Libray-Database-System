CREATE TABLE BOOKS(
 CALL_NO VARCHAR(5),
 ISBN	CHAR(13) NOT NULL,
 TITLE  VARCHAR(10), 
 AUTHOR VARCHAR(10), 
 AMOUNT	INT,
 LOCATION   CHAR(5), 
 PRIMARY KEY(CALL_NO));

 CREATE TABLE STUDENTS(
 SID	CHAR(8)	NOT NULL,
 SNAME VARCHAR(30),
 GENDER  CHAR(1),
 Dep VARCHAR(10),
 BORROW_NO int,
 PRIMARY KEY(SID));

CREATE TABLE BORROW(
 SID CHAR(8) NOT NULL,
 CALL_NO VARCHAR(13),
 BORROW_DATE    DATE,
 DUE_DATE   DATE, 
 Renew_Time INT, 
 PRIMARY KEY (SID, CALL_NO),
 FOREIGN KEY (SID) REFERENCES STUDENTS(SID),
 FOREIGN KEY (CALL_NO) REFERENCES BOOKS(CALL_NO));
 
 CREATE TABLE RESERVE
 (SID CHAR(8) NOT NULL,
 CALL_NO VARCHAR(13),
 REQUEST_DATE    DATE,
 PRIMARY KEY (SID, CALL_NO),
 FOREIGN KEY (SID) REFERENCES STUDENTS(SID),
 FOREIGN KEY (CALL_NO) REFERENCES BOOKS(CALL_NO));

 COMMIT;
INSERT INTO BOOKS VALUES('A0000','0-306-40615-1','AA','XX','0','S1E01');
INSERT INTO BOOKS VALUES('B0000','0-306-40615-2','BB','YY','0','S2E02');
INSERT INTO BOOKS VALUES('C1111','0-306-40615-3','CC','ZZ','2','D1E11');
INSERT INTO BOOKS VALUES('B0001','0-306-40615-4','DD','UU','2','G1E00');
INSERT INTO BOOKS VALUES('A1111','0-306-40615-5','EE','VV','2','B1E00');
INSERT INTO BOOKS VALUES('D0101','0-306-40615-6','FF','WW','1','B2E11');
INSERT INTO BOOKS VALUES('E0000','0-306-40615-7','GG','PP','0','X0E22');
INSERT INTO BOOKS VALUES('E0100','0-306-40615-8','HH','QQ','2','X0E21');
INSERT INTO BOOKS VALUES('E0111','0-306-40615-9','II','RR','0','X0E44');

INSERT INTO STUDENTS VALUES('12345678',	'A',	'M',	'Comp', 0);
INSERT INTO STUDENTS VALUES('11111111',	'B',	'M',	'Math', 4);
INSERT INTO STUDENTS VALUES('22222222',	'C',	'F',	'COMM', 2);
INSERT INTO STUDENTS VALUES('33333333',	'D',	'F',	'COMM', 5);
INSERT INTO STUDENTS VALUES('44444444',	'E',	'M',	'Comp', 5);
INSERT INTO STUDENTS VALUES('55555555',	'F',	'M',	'COMM', 2);
INSERT INTO STUDENTS VALUES('66666666',	'G',	'F',	'Math', 0);
INSERT INTO STUDENTS VALUES('77777777',	'H',	'M',	'Comp', 0);

INSERT INTO BORROW VALUES('11111111','D0101','24-Mar-2022','21-Apr-2022', 0);
INSERT INTO BORROW VALUES('55555555','A1111','23-Mar-2022','20-Apr-2022', 0);
INSERT INTO BORROW VALUES('22222222','B0000','31-Mar-2022','12-May-2022', 1);
INSERT INTO BORROW VALUES('11111111','A0000','01-Apr-2022','29-Apr-2022', 0);
INSERT INTO BORROW VALUES('33333333','A0000','03-Apr-2022','01-May-2022', 0);
INSERT INTO BORROW VALUES('11111111','B0000','03-Apr-2022','15-May-2022', 1);
INSERT INTO BORROW VALUES('44444444','C1111','04-Apr-2022','16-May-2022', 1);
INSERT INTO BORROW VALUES('44444444','A0000','06-Apr-2022','04-May-2022', 0);
INSERT INTO BORROW VALUES('33333333','C1111','06-Apr-2022','04-May-2022', 0);
INSERT INTO BORROW VALUES('33333333','A1111','06-Apr-2022','04-May-2022', 0);
INSERT INTO BORROW VALUES('33333333','B0001','06-Apr-2022','04-May-2022', 0);
INSERT INTO BORROW VALUES('44444444','D0101','10-Apr-2022','08-May-2022', 0);
INSERT INTO BORROW VALUES('33333333','D0101','10-Apr-2022','08-May-2022', 0);
INSERT INTO BORROW VALUES('44444444','A1111','14-Apr-2022','12-May-2022', 0);
INSERT INTO BORROW VALUES('55555555','C1111','18-Apr-2022','16-May-2022', 0);
INSERT INTO BORROW VALUES('22222222','E0111','19-Apr-2022','17-May-2022', 0);
INSERT INTO BORROW VALUES('11111111','E0000','20-Apr-2022','18-May-2022', 0);
INSERT INTO BORROW VALUES('44444444','B0001','21-Apr-2022','19-May-2022', 0);

INSERT INTO RESERVE VALUES('12345678','A0000','20-Apr-2022');
INSERT INTO RESERVE VALUES('66666666','E0000','22-Apr-2022');

 create or replace trigger BORROW_AMO
 after insert on BORROW
 For each row
 Begin
 UPDATE BOOKS SET AMOUNT = AMOUNT -1
 where call_no = :New.call_no;
 UPDATE Students SET Borrow_no = Borrow_no +1
 where SID = :NEW.SID;
 END;
 /

CREATE OR REPLACE TRIGGER increase_book_amount
AFTER DELETE ON BORROW
FOR EACH ROW
DECLARE
cnt INTEGER;
BEGIN
SELECT Amount INTO cnt 
FROM BOOKS 
WHERE CALL_NO  = :OLD.CALL_NO;
cnt := cnt + 1;
UPDATE BOOKS
SET Amount = cnt
WHERE CALL_NO = :old.CALL_NO; 
END;
/



COMMIT;

SET AUTOCOMMIT ON